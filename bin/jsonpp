#!/usr/bin/env ruby

require File.expand_path('../../okjson.rb', __FILE__)

def main(file_path)
  case file_path
  when '-h', '--help'
    puts "Usage: jsonpp [file]"
    puts "Pretty-prints the given file or stdin"
  when '-', nil
    input = $stdin.read
  else
    input = File.read file_path
  end

  data = OkJson.decode(input)
  output = OkJson.encode(data)

  puts output
rescue OkJson::Error, OkJson::Utf8Error => ex
  $stderr.puts ex
  exit 1
end

main(ARGV[0])
